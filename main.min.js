var $leftheader=$("#leftheader ");var $rightheader=$("#rightheader ");var $pagetitle=$("#header h1 ");var $footer=$("#footer");var $header=$("#header");var products=[];var categories=[];var cart=[];var cartCount=0;var selectedAttributes=[];var atrCount=0;var total=0;var box={};var searchres=[];var fcat=0;var slider;var mySwiper;var catswiper;var saleslider;var newslider;var totalslider;var imgslider;var activePage;var saleProds=[];var featProds=[];var totProds=[];var isAndroid=navigator.userAgent.toLowerCase().indexOf("android")>=0;function init(){if(localStorage.cart){cart=JSON.parse(localStorage.cart);cartCount=cart.length;updateBubble()}$(document).on("pagecontainershow",function(){var b=$.mobile.pageContainer.pagecontainer("getActivePage");activePage=$.mobile.pageContainer.pagecontainer("getActivePage")[0].id;var a={};if(activePage=="intropage"&&$(".featured",b).hasClass("plain")){if(isAndroid){Swiper.prototype.support.transforms3d=false;a={slidesPerView:"auto",centeredSlides:true,initialSlide:1}}else{a={slidesPerView:"auto",centeredSlides:true,initialSlide:1,tdFlow:{rotate:30,stretch:10,depth:150}}}mySwiper=$(".featured",b).removeClass("plain").swiper(a);catswiper=$("#catswiper").swiper({slidesPerView:"auto",offsetPxBefore:25,offsetPxAfter:10});$(".banners-container").each(function(){$(this).swiper({slidesPerView:"auto",offsetPxBefore:25,offsetPxAfter:10})});getProducts()}});$(document).on("pagebeforeshow","#productpage",function(g){$leftheader.removeClass("hidden");$rightheader.addClass("hidden");selectedAttributes=[];atrCount=0;imgslider=$("#imgslider").swiper({slidesPerView:"auto",watchActiveIndex:true,centeredSlides:true,pagination:".pagination",paginationClickable:true,resizeReInit:false,keyboardControl:true,grabCursor:true,onImagesReady:function(){changeSize()}});var f=$(this).data("url").split("=")[1];var d=products[f];atrCount=d.attributes.length+1;displayImages(d.images);var h="<li data-role='list-divider'>Adatok</li>";h+="<li>"+d.title+"</li>";if(d.description){h+="<li data-role='list-divider'>Leírás</li>";h+="<li>"+d.description+"</li>"}h+="<li data-role='list-divider'>Tulajdonságok</li>";if(d.type==="variable"){var b=[];for(var c=0;c<d.attributes.length;++c){h+="<li><div class='ui-field-contain'>";h+="<label for='"+d.attributes[c].name+"' > "+d.attributes[c].name+" </label>";h+="<select data-mini='true' name='"+d.attributes[c].name+"' id='"+d.attributes[c].name+"' data-index='"+c+"' class='myselectmenu'>";h+="<option value='' disabled selected> "+d.attributes[c].name+" </option>";for(var a=0;a<d.attributes[c].options.length;++a){h+="<option value='"+d.attributes[c].options[a]+"'>"+d.attributes[c].options[a]+" </option>"}h+="</select>";h+="</div></li>"}}h+="<li><div class='ui-field-contain'>";h+="<label for='darab' > Darab </label>";h+="<select data-mini='true' name='darab' id='darab' data-index='"+(atrCount-1)+"' class='myselectmenu'>";h+="<option value='' disabled selected> Darab </option>";for(var c=1;c<=20;++c){h+="<option value='qty"+c+"'>"+c+" </option>"}h+="</select>";h+="</div></li>";h+="<li data-role='list-divider'>Ár</li>";h+="<li>"+displayPrice(d.price_html)+"</li>";h+="<li><a  href='' id='addToCartBtn' data-role='button' data-product='"+f+"#"+d.id+"' >Kosárba</a></li>";$pagetitle.html(d.title);$("#detList").append(h);$("#detList").listview("refresh");$(".myselectmenu").selectmenu();productFilled()});$(document).on("change",".myselectmenu",function(a){selectedAttributes[$(this).data("index")]=this.options[a.target.selectedIndex].text;productFilled()});$(document).on("pagebeforeshow","#prodlist",function(f){var c=$(this).data("url").split("=")[1];var b="";var d=0;for(var a=0;a<products.length;a++){d=jQuery.inArray(c,products[a].categories);if(d>=0){b+="<li><a href='product.html?id="+a+"' data-prodindex='"+a+"'><img src='"+products[a].featured_src+"'><h2 class='ui-li-heading'>"+products[a].title+"</h2><p class='ui-li-desc'>"+displayPrice(products[a].price_html)+" </p></a></li>"}}$pagetitle.html(c);$leftheader.removeClass("hidden");$rightheader.addClass("hidden");$("#prodList").html(b);$("#prodList").listview("refresh")});$(document).on("pagebeforeshow","#cartpage",function(c){var b="";total=0;if(cart.length>0){for(var a=0;a<cart.length;a++){b+="<li><a><img src='"+cart[a]._product.featured_src+"'><h2 class='ui-li-heading'>"+cart[a]._product.title+"</h2><p class='ui-li-desc'>"+displayPrice(cart[a]._product.price_html)+", "+cart[a]._attrib+" </p><span class='ui-li-count ui-btn-up-b ui-btn-corner-all qtylabel'> x "+cart[a]._qty+"</span></a><a id='cartdel' href='' data-rel='button' data-position='"+a+"' >Delete</a></li>";total+=parseFloat(cart[a]._product.price)*parseInt(cart[a]._qty)}b+="<li data-role='list-divider'></li><li><h1>Total: <span id='thetotal'>"+total+"</span> HUF </h1></li>";$("#inCartList").html(b);$("#inCartList").listview("refresh");$("#inCartList").append("<li data-role='list-divider'></li><li><div class='ui-grid-a'><div class='ui-block-a'><a href='#firstPopup' data-rel='popup' data-transition='pop' data-inline='true' data-role='button' data-theme='a' data-position-to='window' >Kosár ürítése</a></div><div class='ui-block-b'><a href='#orderpage' data-transition='slideup' data-inline='true' data-role='button' data-theme='a'>Rendelés</a></div></div></li>").trigger("create")}else{$("#inCartList").html("<li>A kosarad jelenleg üres!</li>")}$pagetitle.html("Kosár");$leftheader.addClass("hidden");$rightheader.addClass("hidden");$("#inCartList").listview("refresh")});$(document).on("click","#cartdel",function(){var c=parseInt($(this).data("position"));var a=parseFloat(cart[c]._product.price)*parseInt(cart[c]._qty);cart.splice(c,1);cartCount--;updateBubble();localStorage.cart=JSON.stringify(cart);$("#inCartList li").eq(c).remove();var b=parseInt($("#thetotal").text())-a;if(b<=0){$("#inCartList").html("<li>A kosarad jelenleg üres!</li>");$("#inCartList").listview("refresh")}else{$("#thetotal").text(b)}});$(document).on("click","#orderbtn",function(){var g;var e=[];var b;for(var c=0;c<cart.length;++c){g={_name:cart[c]._product.title,_prodId:cart[c]._prodId,_qty:cart[c]._qty,_price:cart[c]._product.price,_attrib:cart[c]._attrib.replace("#",",")};e.push(g)}b=JSON.stringify(e);var a=$("#orderForm").find("input, select");var d=$("#orderForm").serialize();var f=d+"&cart="+b;a.prop("disabled",true);request=$.ajax({url:"http://gate1.hu/ios/post.php",crossDomain:true,type:"POST",data:f});request.done(function(h,j,i){});request.fail(function(h,j,i){console.error("The following error occured: "+j,i)});request.always(function(){a.prop("disabled",false);a.val("")});cart=[];cartCount=0;updateBubble();localStorage.cart=JSON.stringify(cart);event.preventDefault();$.mobile.pageContainer.pagecontainer("change","#cartpage",{transition:"slidedown",changeHash:false,reserve:true})});$(document).on("pagebeforeshow","#searchrespage",function(c){var b="";for(var a=0;a<searchres.length;a++){b+="<li><a href='product.html?id="+searchres[a]._id+"' data-prodindex='"+searchres[a]._id+"'><img src='"+searchres[a]._product.featured_src+"'><h2 class='ui-li-heading'>"+searchres[a]._product.title+"</h2><p class='ui-li-desc'>"+displayPrice(searchres[a]._product.price_html)+" </p></a></li>"}$pagetitle.html("Keresés eredménye");$leftheader.removeClass("hidden");$rightheader.addClass("hidden");$("#searchreslist").html(b);$("#searchreslist").listview("refresh")});$(document).on("click","#addToCartBtn",function(){addToCart($(this).data("product"));$(".myselectmenu option").removeAttr("selected");$('.myselectmenu option[value=""]').attr("selected","selected");$("span.myselectmenu").text("-");selectedAttributes=[];productFilled();displayNofy("Kosarad frissült!")});$(document).on("click","#confirmempty",function(){cart=[];localStorage.cart=JSON.stringify(cart);cartCount=0;updateBubble();$("#inCartList").html("<li>A kosarad jelenleg üres!</li>");$("#inCartList").listview("refresh")});$(document).on("pagebeforeshow","#categorypage",function(a){$leftheader.removeClass("hidden");$rightheader.addClass("hidden");$pagetitle.html("Kategóriák")});$(document).on("pagebeforeshow","#orderpage",function(a){$leftheader.removeClass("hidden");$rightheader.addClass("hidden");$pagetitle.html("Rendelés")});$(document).on("pagebeforeshow","#intropage",function(a){$leftheader.addClass("hidden");$rightheader.removeClass("hidden");$pagetitle.html("<img src='img/logo.png' id='logo'>")});$("#search input, #search select").change(function(){calculateSearchResult()});$("#priceslider").on("slidestop",function(a){calculateSearchResult()});$(document).on("pagebeforeshow","#searchpage",function(c){var a="<option value=''>Kategóriák:</option>";for(var b=0;b<categories.length;b++){a+="<option value='"+categories[b].Name+"'>"+categories[b].Name+"</option>"}$("#search #categories").html(a).selectmenu("refresh");checkSearchRes();$("#search").listview("refresh");$leftheader.addClass("hidden");$rightheader.addClass("hidden");$pagetitle.html("Keresés")});$(document).on("pageshow","#intropage",function(){if(mySwiper){mySwiper.reInit();mySwiper.resizeFix(true)}});$(document).on("focus","input, textarea, select",function(){$footer.addClass("hidden");$header.addClass("hidden")});$(document).on("blur","input, textarea, select",function(){$footer.removeClass("hidden");$header.removeClass("hidden")})}function calculateSearchResult(){searchres=[];var g=$("#search #name"),b=$("#search #categories"),h=$("#search #armin"),e=$("#search #armax");var f=true,a=true,d=true;for(var c=0;c<products.length;++c){if(b.val()){f=checkInCat(products[c],b.val())}d=checkInPrice(products[c],h.val(),e.val());a=checkInName(products[c],g.val());if(f&&d&&a){addProdToSRes(products[c],c)}}checkSearchRes();$("#search").listview("refresh")}function checkSearchRes(){console.log("Sres: "+searchres.length);if(searchres.length>0){$("#resultcount").text("("+searchres.length+")");$("#searchresbtn").prop("disabled",false).toggleClass("ui-state-disabled",false).addClass("btnok")}else{$("#resultcount").text("(0)");$("#searchresbtn").prop("disabled",true).toggleClass("ui-state-disabled btnok",true).removeClass("btnok")}}function checkInCat(d,c){if(c.length>0){for(var b=0;b<d.categories.length;++b){for(var a=0;a<c.length;++a){if(c[a]==d.categories[b]){return true}}}}return false}function checkInPrice(c,b,a){if((b<=parseFloat(c.price))&&(parseFloat(c.price)<=a)){return true}return false}function checkInName(b,a){if(b.title.toLowerCase().indexOf(a.toLowerCase())>=0){return true}return false}function addToCart(g){var a=g.split("#");var e=products[a.shift()];var d=a.shift();var f=a.pop();var c=a.join("#");box={_product:e,_prodId:d,_qty:f,_attrib:c};var b=checkInCart(d,c,f);if(!b){cart.push(box);cartCount++;updateBubble()}localStorage.cart=JSON.stringify(cart)}function checkInCart(a,c,d){for(var b=0;b<cart.length;++b){if((cart[b]._product.id==a)&&(cart[b]._attrib==c)){cart[b]._qty=parseInt(d)+parseInt(cart[b]._qty);return true}}return false}function addProdToSRes(b,e){var c={_product:b,_id:e};if(searchres.length==0){searchres.push(c)}else{var d=0;for(var a=0;a<searchres.length;++a){if(searchres[a]._product.id==b.id){d=1;break}}if(d==0){searchres.push(c)}}}function updateBubble(){if(cartCount>0){$("#cartnumber").text(cartCount).removeClass("hidden")}else{$("#cartnumber").addClass("hidden")}}function productFilled(){var a=$("#addToCartBtn");if(atrCount!=selectedAttributes.length){if(!a.prop("disabled")){a.prop("disabled",true).toggleClass("ui-state-disabled",true).removeClass("btnok")}}else{a.prop("disabled",false).toggleClass("ui-state-disabled",false).addClass("btnok");var b=a.data("product");b+="#"+selectedAttributes.join("#");a.data("product",b);a.attr("data-product",b)}}function changeSize(){$("#imgslider .swiper-slide").css("width","");var a=$("#imgslider .swiper-slide img").width();if(a>$(window).width()){a=$(window).width()}$("#imgslider .swiper-slide").css("width",a);$("#imgslider").css({height:""});$("#imgslider").css({height:$("#imgslider ").find("img").height()});imgslider.resizeFix(true);imgslider.reInit()}function displayImages(a){for(var c=0;c<a.length;++c){var b=imgslider.createSlide("<div class='inner'><img src='"+a[c].src+"'></div>");imgslider.appendSlide(b)}imgslider.removeSlide(0)}function getProducts(){var a="http://gate1.hu/pnc/json.php";$.ajax({type:"GET",url:a,async:false,contentType:"application/json",dataType:"jsonp",success:function(b){console.log("succes! ");products=b.products;localStorage.products=JSON.stringify(products);getCategories();displayProducts()},error:function(b){console.log("Hiba! Nincs internet vagy nem érhető el a szerver"+b.message);$("#introContentNoFeeds").html("Sorry, no connection with the server. In order to use the application you need Internet connection")}})}function getCategories(){var d=0;var c=[];for(var b=0;b<products.length;b++){if(products[b].featured){featProds.push(b)}if(products[b].on_sale){saleProds.push(b)}if(products[b].total_sales>0){totProds.push(b)}for(var a=0;a<products[b].categories.length;a++){d=jQuery.inArray(products[b].categories[a],c);if(d>=0){categories[d].Count+=1}else{categories.push({Name:products[b].categories[a],Count:1});c.push(products[b].categories[a])}}}localStorage.categories=JSON.stringify(categories);fcat=1;displayCategories()}function displayNofy(a){$("<div class='noty ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h1>"+a+"</h1></div>").appendTo($.mobile.pageContainer).delay(1000).fadeOut(800,function(){})}function displayPrice(b){var c;var a=$.trim(b).split("&nbsp;&#70;&#116;");if(a.length==3){c="<span class='saleprice'>"+a[0]+" Ft </span>"+a[1]+" Ft"}else{c=a[0]+" Ft"}return c}function displayProducts(){if(products.length==0){$("#feedList").html("")}else{$("#introContentNoFeeds").fadeOut("normal");for(var a=0;a<featProds.length;a++){addNewFeaturedSlide(featProds[a],mySwiper)}mySwiper.removeSlide(0);if(categories.length>0){addNewSlider("category")}if(saleProds.length>0){addNewSlider("sale")}addNewSlider("new");if(totProds.length>0){addNewSlider("total")}}}function addNewFeaturedSlide(c,d){var e=products[c];var b="";if(!isAndroid){b+="<div class='swiper-slide-shadow-left'></div><div class='swiper-slide-shadow-right'></div>"}var a=d.createSlide("<div class='prodcard' style='background-image:url("+e.featured_src+")'><a href='product.html?id="+c+"' data-feed='"+c+"'><span class='slititle'>"+e.title+"</span><span class='sliprice'>"+displayPrice(e.price_html)+"</span></a></div>"+b);d.appendSlide(a)}function addNewSlide(b,c){var d=products[b];var a=c.createSlide("<a href='product.html?id="+b+"' data-feed='"+b+"'> <img src='"+d.featured_src+"' height='150' width='150'>  <div class='app-title'>"+d.title+"</div></a><div class='app-category'>"+d.categories+"</div><div class='app-price'>"+displayPrice(d.price_html)+"</div>");c.appendSlide(a)}function addNewSlider(c){var e;var f=c;var d;if(c==="sale"){saleslider=$("#saleslider").swiper({slidesPerView:"auto",offsetPxBefore:25,offsetPxAfter:10,calculateHeight:true});d=$("#saleslider");d.find(".thumbs-title").html("Akciós termékek");for(var b=0;b<saleProds.length;b++){addNewSlide(saleProds[b],saleslider)}saleslider.removeSlide(0)}if(c==="category"){for(var b=0;b<categories.length;b++){var a=catswiper.createSlide("<a href='productlist.html?cat="+categories[b].Name+"'><div class='banner'><span class='catslidename'>"+categories[b].Name+"</span><span class='catslidecount'>"+categories[b].Count+"</span></div></a>");catswiper.appendSlide(a)}catswiper.removeSlide(0)}if(c==="new"){newslider=$("#newslider").swiper({slidesPerView:"auto",offsetPxBefore:25,offsetPxAfter:10,calculateHeight:true});d=$("#newslider");d.find(".thumbs-title").html("Legújabb termékek");for(var b=0;b<10;b++){addNewSlide(b,newslider)}newslider.removeSlide(0)}if(c==="total"){totalslider=$("#totalslider").swiper({slidesPerView:"auto",offsetPxBefore:25,offsetPxAfter:10,calculateHeight:true});d=$("#totalslider");d.find(".thumbs-title").html("Legtöbbet eladott");for(var b=0;b<totProds.length;b++){addNewSlide(totProds[b],totalslider)}totalslider.removeSlide(0)}}function displayCategories(){var b="";for(var a=0;a<categories.length;a++){b+="<li><a href='productlist.html?cat="+categories[a].Name+"'>"+categories[a].Name+"<span class='ui-li-count'>"+categories[a].Count+"</span></a></li>"}$("#catList").html(b)}function addFeed(c,b){var a=getFeeds();a.push({name:c,url:b});localStorage.feeds=JSON.stringify(a)}function removeFeed(b){var a=getFeeds();a.splice(b,1);localStorage.feeds=JSON.stringify(a);displayFeeds()}function handleAddFeed(){var a=$.trim($("#feedname").val());var b=$.trim($("#feedurl").val());var c="";if(a==""){c+="Feed name is required.\n"}if(b==""){c+="Feed url is required.\n"}if(c!=""){navigator.notification.alert(c,function(){})}else{addFeed(a,b);$.mobile.changePage("index.html")}}$(window).resize(function(){if(activePage=="productpage"){changeSize()}if(activePage=="intropage"){mySwiper.reInit();mySwiper.resizeFix(true)}});